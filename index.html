<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="#">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <title>Sistem Antrian Montecarlo</title>
    <style>
        body {
            margin: 5%;
        }
    </style>
  </head>
  <body>
      <div class="container">
        <table class="table table-bordered table-striped">
            <thead>
                <tr class="text-center">
                    <th>Pelanggan</th>
                    <th>Datang</th>
                    <th>Dilayani</th>
                    <th>Selesai</th>
                    <th style="width: 20%;"></th>
                    <th>Lama Pelayanan (Menit)</th>
                    <th>Waktu Dalam Sistem (Menit)</th>
                    <th>Waktu Mengantri (Menit)</th>
                </tr>
            </thead>
            <tbody id="table-antrian" class="text-center">
            </tbody>
        </table>

        <table class="table table-bordered table-striped">
            <thead>
                <tr class="text-center">
                    <th>Input</th>
                    <th>Waktu / Pelayanan</th>
                </tr>
            </thead>
            <tbody id="table-loket" class="text-center">
            </tbody>
        </table>

        <table class="table table-bordered table-striped">
            <thead>
                <tr class="text-center">
                    <th>Interval Waktu Kedatangan</th>
                    <th>Bilangan Acak</th>
                </tr>
            </thead>
            <tbody id="table-kedatangan" class="text-center">
            </tbody>
        </table>
      </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const tableAntrian = document.querySelector('#table-antrian');
        const tableLoket = document.querySelector('#table-loket');
        const tableKedatangan = document.querySelector('#table-kedatangan');
        const file = fetch('data.json').then(res => res.json());

        const convertToTime = time => {
            let array = time.split(':');
            return (+array[0]) * 60 * 60 + (+array[1]) * 60;
        };
        
        const print = async () => {
            const datas = await file;
            
            let dataTable = '';
            let jumlahWaktuAntrian = 0;
            let waktuPelayanan = [];
            let split = []
            datas.forEach(data => {
                const kedatangan = convertToTime(data.kedatangan);
                const dilayani = convertToTime(data.dilayani);
                const selesai = convertToTime(data.selesai);

                const lamaPelayanan = (selesai - dilayani) / 60;
                const waktuDalamSistem = (selesai - kedatangan) / 60;
                const waktuMengantri = (dilayani - kedatangan) / 60;

                waktuPelayanan.push(lamaPelayanan);

                jumlahWaktuAntrian += waktuMengantri;
                dataTable += `<tr>
                                <td>${data.pelanggan}</td>
                                <td>${data.kedatangan}</td>
                                <td>${data.dilayani}</td>
                                <td>${data.selesai}</td>
                                <td></td>
                                <td>${lamaPelayanan}</td>
                                <td>${waktuDalamSistem}</td>
                                <td>${waktuMengantri}</td>
                              </tr>`;

                split.push(+data.kedatangan.split(':')[1]);
            })
            let waktuKedatangan = [];
            for(let i= split.length; i >= 0; i--){
                let newArray = split[i] - split[i - 1];
                if(!isNaN(newArray)) waktuKedatangan.push(newArray)
            }
            
            dataTable += `<tr>
                            <td colspan="7">Rata-rata waktu menunggu antrian</td>
                            <td>${(jumlahWaktuAntrian / datas.length).toFixed(2)} Menit</td>
                          </tr>`;
            
            tableAntrian.innerHTML = dataTable;
            
            const minWaktuKedatangan = Math.min.apply(null, waktuKedatangan);
            const maxWaktuKedatangan = Math.max.apply(null, waktuKedatangan);

            const minWaktuPelayanan = Math.min.apply(null, waktuPelayanan);
            const maxWaktuPelayanan = Math.max.apply(null, waktuPelayanan);
            const nilaiInterval = Math.floor(datas.length / Math.max.apply(null, waktuPelayanan));
                    
            tableLoket.innerHTML = `<tr>
                                        <td>Jumlah Pelanggan</td>
                                        <td>${datas.length} Pelanggan</td>
                                    </tr>
                                    <tr>
                                        <td>Waktu Kedatangan</td>
                                        <td>${minWaktuKedatangan + ' - ' + maxWaktuKedatangan} Menit</td>
                                    </tr>
                                    <tr>
                                        <td>Waktu Pelayanan</td>
                                        <td>${minWaktuPelayanan + ' - ' + maxWaktuPelayanan} Menit</td>
                                    </tr>
                                    <tr>
                                        <td>Jumlah Interval</td>
                                        <td>${datas.length}/${maxWaktuPelayanan} = ${ nilaiInterval } Nilai</td>
                                    </tr>`;
            
            let dataTableWaktuKedatangan = '';
            let z = 0;
            let x = 1;
            for(let i=minWaktuKedatangan; i<maxWaktuPelayanan; i++){
                z = z + nilaiInterval
                dataTableWaktuKedatangan += `<tr>
                                                <td>${i}</td>
                                                <td>${x} - ${z}</td>
                                            </tr>`
                x = z + 1
            }
            tableKedatangan.innerHTML = dataTableWaktuKedatangan;
        }
        print()
    </script>
  </body>
</html>
